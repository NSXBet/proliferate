kubernetes:
  base:
    sourceRepo:
      name: sample-app
      org: NSXBet
    monoRepo:
      url: git@github.com:NSXBet/monorepo-gitops.git
      appsFolder: apps-config
      argoCDValues: helms/argocd/values.yaml
      repository: monorepo-gitops
    containerRegistry:
      url: 492684252576.dkr.ecr.us-east-1.amazonaws.com
    deployConfig:
      cluster: EKS-NSX-Staging
      environment: staging
      steps:
      - build
      - push
      - versioning
      - deploy
      service:
        istio: enabled
    metadata:
      team: xablau
  apps:
  - name: sample-app-public
    dockerfile: ./Dockerfile
    imagePullPolicy: Always
    kind: deployment
    replicas: 1
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 128Mi
    service:
      healthcheck:
        initialDelaySeconds: 5
        interval: 30
        path: /
        port: 3000
        timeoutSeconds: 5
      istio: true
      ports:
      - containerPort: 3000
        name: sample-app-public
        virtualservice:
          gateway: public-gateway
          hosts:
          - sample-app-staging.webdevelopers.com.br
  - name: sample-app-internal
    dockerfile: ./Dockerfile
    imagePullPolicy: Always
    kind: rollout
    strategy:
      type: canary
      steps:
      - setWeight: 20
      - pause: {}
      - setWeight: 40
      - pause:
          duration: 40s
      - setWeight: 60
      - pause:
          duration: 20s
      - setWeight: 80
      - pause:
          duration: 20s
    replicas: 1
    resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 128Mi
    hpa:
      maxReplicas: 2
      minReplicas: 1
      targetCPUUtilizationPercentage: 60
    service:
      healthcheck:
        initialDelaySeconds: 5
        interval: 30
        path: /
        port: 3000
        timeoutSeconds: 5
      istio: true
      ports:
      - containerPort: 3000
        name: sample-app-internal
        virtualservice:
          gateway: internal-gateway
          hosts:
          - sample-app-staging.nsx.services